[file name]: history.html
[file content begin]
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ticket History Dashboard — Tomoca IT Support</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4e2b18;
      --secondary: #d4a373;
      --light: #f8f5f2;
      --dark: #2c1810;
      --card: #ffffff;
      --muted: #6b7280;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      --border: #e5e7eb;
      --radius: 12px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #f8f5f2 0%, #f0ebe6 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      overflow: hidden;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 22px;
      font-weight: 700;
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .brand h1 {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .brand p {
      font-size: 14px;
      color: var(--muted);
    }

    /* Main Card */
    .main-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }

    .card-header {
      margin-bottom: 30px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 20px;
    }

    .card-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .card-header h2 i {
      color: var(--secondary);
    }

    .card-header .subtitle {
      color: var(--muted);
      font-size: 15px;
      max-width: 800px;
    }

    /* Ticket Input Area */
    .input-section {
      background: var(--light);
      border-radius: 10px;
      padding: 24px;
      margin-bottom: 30px;
      border: 2px dashed var(--border);
    }

    .input-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .input-header h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .input-options {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #6b3920);
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #6b3920, var(--primary));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(78, 43, 24, 0.25);
    }

    .btn-secondary {
      background: var(--card);
      color: var(--dark);
      border: 2px solid var(--border);
    }

    .btn-secondary:hover {
      background: white;
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
    }

    .btn-success:hover {
      background: linear-gradient(135deg, #059669, var(--success));
      transform: translateY(-2px);
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning), #d97706);
      color: white;
    }

    .btn-warning:hover {
      background: linear-gradient(135deg, #d97706, var(--warning));
      transform: translateY(-2px);
    }

    textarea.ticket-input {
      width: 100%;
      min-height: 120px;
      padding: 16px;
      border-radius: 10px;
      border: 2px solid var(--border);
      font-family: 'Poppins', sans-serif;
      font-size: 15px;
      background: white;
      color: var(--dark);
      resize: vertical;
      margin-bottom: 20px;
    }

    textarea.ticket-input:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(212, 163, 115, 0.2);
    }

    .input-help {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 13px;
      margin-top: 10px;
    }

    .kbd {
      background: var(--card);
      padding: 4px 10px;
      border-radius: 6px;
      border: 1px solid var(--border);
      font-family: 'Courier New', monospace;
      font-weight: 600;
      color: var(--primary);
    }

    /* Staff Selection */
    .staff-section {
      background: var(--light);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .staff-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .staff-header h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .staff-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .staff-card {
      background: var(--card);
      border-radius: 10px;
      padding: 20px;
      border: 2px solid var(--border);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .staff-card:hover {
      border-color: var(--secondary);
      transform: translateY(-3px);
      box-shadow: var(--shadow);
    }

    .staff-card.selected {
      border-color: var(--primary);
      background: linear-gradient(135deg, rgba(139, 69, 19, 0.05), rgba(212, 163, 115, 0.05));
    }

    .staff-info {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .staff-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--secondary), var(--primary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 18px;
    }

    .staff-details h4 {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .staff-details p {
      font-size: 13px;
      color: var(--muted);
    }

    .staff-stats {
      display: flex;
      gap: 15px;
      font-size: 12px;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--muted);
    }

    .stat-item i {
      color: var(--primary);
    }

    /* Progress Section */
    .progress-section {
      background: var(--light);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .progress-stats {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .stat-badge {
      background: var(--card);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-badge i {
      color: var(--primary);
    }

    .progress-wrap {
      height: 10px;
      background: var(--border);
      border-radius: 999px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    .progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 0.5s ease;
    }

    /* Results Section */
    .results-section {
      margin-bottom: 30px;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .results-actions {
      display: flex;
      gap: 12px;
    }

    .ticket-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .ticket-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      border-top: 4px solid var(--primary);
      transition: all 0.3s ease;
    }

    .ticket-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }

    .ticket-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 15px;
    }

    .ticket-id {
      font-family: 'Courier New', monospace;
      font-weight: 700;
      font-size: 16px;
      color: var(--primary);
    }

    .ticket-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-open {
      background: #ffedd5;
      color: #c2410c;
    }

    .status-in_progress {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .status-resolved {
      background: #d1fae5;
      color: #065f46;
    }

    .ticket-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .meta-item {
      font-size: 13px;
    }

    .meta-label {
      color: var(--muted);
      font-weight: 500;
      margin-bottom: 3px;
    }

    .meta-value {
      font-weight: 600;
      color: var(--dark);
    }

    .ticket-description {
      font-size: 14px;
      color: var(--muted);
      line-height: 1.5;
      margin-bottom: 15px;
      max-height: 100px;
      overflow: hidden;
      position: relative;
    }

    .ticket-description::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(to bottom, transparent, var(--card));
    }

    .ticket-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .action-btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .action-btn.view {
      background: var(--light);
      color: var(--dark);
    }

    .action-btn.view:hover {
      background: var(--primary);
      color: white;
    }

    .action-btn.history {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .action-btn.history:hover {
      background: #3b82f6;
      color: white;
    }

    .action-btn.copy {
      background: #f3f4f6;
      color: var(--dark);
    }

    .action-btn.copy:hover {
      background: #9ca3af;
      color: white;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal {
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      max-width: 800px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow-hover);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border);
    }

    .modal-header h3 {
      font-size: 22px;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      color: var(--muted);
      cursor: pointer;
    }

    .modal-content {
      margin-bottom: 25px;
    }

    .ticket-detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .ticket-detail {
      margin-bottom: 15px;
    }

    .ticket-detail label {
      font-weight: 600;
      color: var(--primary);
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
    }

    .ticket-detail .value {
      background: var(--light);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-size: 15px;
    }

    .history-list {
      margin-top: 20px;
    }

    .history-item {
      background: var(--light);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid var(--secondary);
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .history-actor {
      font-weight: 600;
      color: var(--primary);
    }

    .history-time {
      color: var(--muted);
      font-size: 13px;
    }

    .history-action {
      color: var(--muted);
      font-size: 14px;
      font-style: italic;
      margin-bottom: 5px;
    }

    .history-note {
      font-size: 14px;
      line-height: 1.5;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 30px;
      background: var(--light);
      border-radius: var(--radius);
      border: 2px dashed var(--border);
    }

    .empty-icon {
      font-size: 48px;
      color: var(--muted);
      margin-bottom: 20px;
    }

    .empty-state h3 {
      font-size: 20px;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .empty-state p {
      color: var(--muted);
      max-width: 500px;
      margin: 0 auto 20px;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 20px 0;
      margin-top: 40px;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 14px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      .main-card {
        padding: 20px;
      }

      .header {
        flex-direction: column;
        text-align: center;
        gap: 20px;
      }

      .input-options {
        flex-wrap: wrap;
      }

      .staff-grid {
        grid-template-columns: 1fr;
      }

      .ticket-list {
        grid-template-columns: 1fr;
      }

      .results-header {
        flex-direction: column;
        gap: 15px;
        align-items: stretch;
      }

      .results-actions {
        justify-content: center;
      }

      .progress-stats {
        flex-wrap: wrap;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Modal for Ticket Details -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <div class="modal-header">
        <h3><i class="fas fa-ticket-alt"></i> Ticket Details</h3>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>
      <div class="modal-content" id="modalContent">
        <!-- Ticket details will be loaded here -->
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo-container">
        <div class="logo">
          <img src="./assets/logo.jpg" alt="Tomoca Coffee Logo" onerror="this.style.display='none'; this.parentElement.innerHTML='☕'; this.parentElement.style.fontSize='24px';">
        </div>
        <div class="brand">
          <h1>Tomoca IT Support</h1>
          <p>Ticket History & Analytics Dashboard</p>
        </div>
      </div>
      <div>
        <a href="index.html" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Portal
        </a>
      </div>
    </header>

    <!-- Main Card -->
    <div class="main-card">
      <div class="card-header">
        <h2><i class="fas fa-history"></i> Batch Ticket Lookup</h2>
        <p class="subtitle">Paste multiple ticket IDs (one per line or comma-separated) or upload a CSV file. Export results in Excel-compatible format for staff task logging.</p>
      </div>

      <!-- Ticket Input Section -->
      <div class="input-section">
        <div class="input-header">
          <h3><i class="fas fa-clipboard-list"></i> Ticket IDs to Lookup</h3>
          <div class="input-options">
            <button class="btn btn-secondary" id="btnClear">
              <i class="fas fa-trash-alt"></i> Clear All
            </button>
            <label for="fileInput" class="btn btn-secondary" style="cursor: pointer;">
              <i class="fas fa-upload"></i> Upload CSV/TXT
            </label>
            <input id="fileInput" type="file" accept=".txt,.csv" style="display: none">
          </div>
        </div>
        <textarea id="ticketInput" class="ticket-input" placeholder="Enter ticket IDs, one per line or comma-separated:
Example:
TOM-176
TOM-42
TOM-89, TOM-101, TOM-112"></textarea>
        <div class="input-help">
          <i class="fas fa-info-circle"></i>
          <span>Accepted formats: <span class="kbd">TOM-176</span>, <span class="kbd">TKT-20241234</span>, or any ticket ID pattern. Supports CSV upload with ID column.</span>
        </div>
      </div>

      <!-- Staff Selection Section -->
      <div class="staff-section">
        <div class="staff-header">
          <h3><i class="fas fa-users"></i> Assign to Staff Member</h3>
          <span id="selectedStaff" style="color: var(--primary); font-weight: 600;">No staff selected</span>
        </div>
        <div class="staff-grid" id="staffGrid">
          <!-- Staff cards will be populated by JavaScript -->
        </div>
      </div>

      <!-- Progress Section -->
      <div class="progress-section">
        <div class="progress-header">
          <h3><i class="fas fa-chart-line"></i> Lookup Progress</h3>
          <div class="progress-stats">
            <div class="stat-badge" id="totalTickets">
              <i class="fas fa-ticket-alt"></i> Total: 0
            </div>
            <div class="stat-badge" id="processedTickets">
              <i class="fas fa-check-circle"></i> Processed: 0
            </div>
            <div class="stat-badge" id="successTickets">
              <i class="fas fa-thumbs-up"></i> Success: 0
            </div>
            <div class="stat-badge" id="errorTickets">
              <i class="fas fa-exclamation-circle"></i> Errors: 0
            </div>
          </div>
        </div>
        <div class="progress-wrap">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
        <button class="btn btn-primary" id="btnLookup">
          <i class="fas fa-search"></i> Lookup Tickets
        </button>
        <button class="btn btn-success" id="btnExportExcel">
          <i class="fas fa-file-excel"></i> Export to Excel
        </button>
        <button class="btn btn-warning" id="btnExportCSV">
          <i class="fas fa-file-csv"></i> Export CSV (Task Log)
        </button>
        <button class="btn btn-secondary" id="btnCopyAll">
          <i class="fas fa-copy"></i> Copy All JSON
        </button>
      </div>

      <!-- Results Section -->
      <div class="results-section">
        <div class="results-header">
          <h3><i class="fas fa-list-alt"></i> Results <span id="resultsCount" style="color: var(--muted); font-weight: 400;">(0 tickets)</span></h3>
          <div class="results-actions">
            <button class="btn btn-secondary" id="btnExpandAll">
              <i class="fas fa-expand"></i> Expand All
            </button>
            <button class="btn btn-secondary" id="btnCollapseAll">
              <i class="fas fa-compress"></i> Collapse All
            </button>
          </div>
        </div>
        <div id="resultsContainer">
          <!-- Results will be loaded here -->
          <div class="empty-state">
            <div class="empty-icon">
              <i class="fas fa-search"></i>
            </div>
            <h3>No Tickets Looked Up</h3>
            <p>Enter ticket IDs above and click "Lookup Tickets" to start. Results will appear here with detailed information and export options.</p>
            <p><small>Pro Tip: Use the staff assignment feature above to organize tickets by team member before exporting.</small></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>© 2024 Tomoca Coffee IT Department • Ticket History Dashboard v2.0 • Last Updated: Today</p>
      <p style="font-size: 12px; margin-top: 8px;">
        <i class="fas fa-shield-alt"></i> Secure Connection • 
        <i class="fas fa-bolt"></i> Fast Batch Processing • 
        <i class="fas fa-database"></i> Real-time Data
      </p>
    </footer>
  </div>

  <script>
    (function() {
      // Backend configuration
      const BACKEND_BASE = 'https://tomoca.onrender.com';

      // DOM Elements
      const elements = {
        ticketInput: document.getElementById('ticketInput'),
        btnLookup: document.getElementById('btnLookup'),
        btnClear: document.getElementById('btnClear'),
        btnExportExcel: document.getElementById('btnExportExcel'),
        btnExportCSV: document.getElementById('btnExportCSV'),
        btnCopyAll: document.getElementById('btnCopyAll'),
        btnExpandAll: document.getElementById('btnExpandAll'),
        btnCollapseAll: document.getElementById('btnCollapseAll'),
        fileInput: document.getElementById('fileInput'),
        staffGrid: document.getElementById('staffGrid'),
        selectedStaff: document.getElementById('selectedStaff'),
        resultsContainer: document.getElementById('resultsContainer'),
        resultsCount: document.getElementById('resultsCount'),
        progressBar: document.getElementById('progressBar'),
        totalTickets: document.getElementById('totalTickets'),
        processedTickets: document.getElementById('processedTickets'),
        successTickets: document.getElementById('successTickets'),
        errorTickets: document.getElementById('errorTickets'),
        modalOverlay: document.getElementById('modalOverlay'),
        closeModal: document.getElementById('closeModal'),
        modalContent: document.getElementById('modalContent')
      };

      // State
      let currentStaff = null;
      let results = [];
      let staffMembers = [
        { id: 'bereket', name: 'Bereket Tesfaye', role: 'IT Manager', email: 'bereket@tomoca.com', color: '#4e2b18' },
        { id: 'temesgen', name: 'Temesgen Abebe', role: 'Senior IT Specialist', email: 'temesgen@tomoca.com', color: '#d4a373' },
        { id: 'yonas', name: 'Yonas Girma', role: 'IT Support Technician', email: 'yonas@tomoca.com', color: '#2c1810' },
        { id: 'helen', name: 'Helen Kebede', role: 'System Administrator', email: 'helen@tomoca.com', color: '#8B4513' }
      ];

      // Initialize
      document.addEventListener('DOMContentLoaded', init);

      function init() {
        console.log('Initializing Ticket History Dashboard...');
        setupEventListeners();
        renderStaffGrid();
      }

      function setupEventListeners() {
        // Lookup button
        elements.btnLookup.addEventListener('click', handleLookup);
        
        // Clear button
        elements.btnClear.addEventListener('click', () => {
          elements.ticketInput.value = '';
          results = [];
          renderResults();
          updateProgress(0, 0);
        });

        // Export buttons
        elements.btnExportExcel.addEventListener('click', exportToExcel);
        elements.btnExportCSV.addEventListener('click', exportToCSV);
        elements.btnCopyAll.addEventListener('click', copyAllToClipboard);
        
        // Expand/Collapse buttons
        elements.btnExpandAll.addEventListener('click', () => toggleAllDescriptions(true));
        elements.btnCollapseAll.addEventListener('click', () => toggleAllDescriptions(false));

        // File upload
        elements.fileInput.addEventListener('change', handleFileUpload);

        // Modal close
        elements.closeModal.addEventListener('click', () => {
          elements.modalOverlay.style.display = 'none';
        });

        // Close modal when clicking outside
        elements.modalOverlay.addEventListener('click', (e) => {
          if (e.target === elements.modalOverlay) {
            elements.modalOverlay.style.display = 'none';
          }
        });
      }

      function renderStaffGrid() {
        elements.staffGrid.innerHTML = '';
        
        staffMembers.forEach(staff => {
          const card = document.createElement('div');
          card.className = 'staff-card';
          card.dataset.staffId = staff.id;
          
          // Generate random stats for demo
          const openTickets = Math.floor(Math.random() * 10) + 1;
          const resolvedToday = Math.floor(Math.random() * 5) + 1;
          const avgResponse = `${Math.floor(Math.random() * 30) + 15}m`;
          
          card.innerHTML = `
            <div class="staff-info">
              <div class="staff-avatar" style="background: linear-gradient(135deg, ${staff.color}, ${staff.color}80);">
                ${staff.name.charAt(0)}
              </div>
              <div class="staff-details">
                <h4>${staff.name}</h4>
                <p>${staff.role}</p>
                <small>${staff.email}</small>
              </div>
            </div>
            <div class="staff-stats">
              <div class="stat-item">
                <i class="fas fa-ticket-alt"></i>
                <span>${openTickets} Open</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-check-circle"></i>
                <span>${resolvedToday} Today</span>
              </div>
              <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span>${avgResponse} Avg</span>
              </div>
            </div>
          `;
          
          card.addEventListener('click', () => {
            document.querySelectorAll('.staff-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            currentStaff = staff;
            elements.selectedStaff.textContent = `Selected: ${staff.name}`;
            elements.selectedStaff.style.color = staff.color;
          });
          
          elements.staffGrid.appendChild(card);
        });
      }

      function handleFileUpload(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
          const content = event.target.result;
          // Try to parse CSV or just use as text
          if (file.name.endsWith('.csv')) {
            // Simple CSV parsing - just extract IDs from first column
            const lines = content.split('\n');
            const ids = lines
              .slice(1) // Skip header
              .map(line => {
                const columns = line.split(',');
                return columns[0] ? columns[0].trim() : null;
              })
              .filter(id => id && id.length > 0);
            
            if (ids.length > 0) {
              elements.ticketInput.value = ids.join('\n');
            } else {
              // If CSV parsing fails, use as plain text
              elements.ticketInput.value = content;
            }
          } else {
            // Plain text file
            elements.ticketInput.value = content;
          }
          
          elements.fileInput.value = ''; // Reset file input
        };
        reader.readAsText(file);
      }

      async function handleLookup() {
        const rawInput = elements.ticketInput.value.trim();
        if (!rawInput) {
          alert('Please enter at least one ticket ID');
          return;
        }

        // Parse ticket IDs
        const ids = parseTicketIds(rawInput);
        if (ids.length === 0) {
          alert('No valid ticket IDs found. Please check your input.');
          return;
        }

        // Reset results
        results = [];
        renderResults();
        updateProgress(0, ids.length);

        // Disable buttons during lookup
        setButtonsDisabled(true);

        try {
          // Fetch tickets with concurrency control
          results = await fetchTicketsWithConcurrency(ids, 4);
          
          // Update UI
          renderResults();
          
          // Show success message
          const successCount = results.filter(r => r.status === 'success').length;
          const errorCount = results.filter(r => r.status === 'error').length;
          
          if (errorCount > 0) {
            alert(`Lookup completed with ${successCount} successful and ${errorCount} failed lookups.`);
          } else {
            alert(`Successfully looked up ${successCount} tickets!`);
          }
          
        } catch (error) {
          console.error('Lookup error:', error);
          alert('An error occurred during lookup. Please check console for details.');
        } finally {
          setButtonsDisabled(false);
        }
      }

      function parseTicketIds(rawText) {
        // Split by new lines and commas, trim, and filter empty strings
        return rawText
          .split(/[\n,]+/)
          .map(id => id.trim())
          .filter(id => id.length > 0 && !id.startsWith('#') && !id.startsWith('//'))
          .map(id => id.replace(/["']/g, '')); // Remove quotes
      }

      async function fetchTicketsWithConcurrency(ids, maxConcurrent = 4) {
        const results = new Array(ids.length);
        let processed = 0;
        let successCount = 0;
        let errorCount = 0;

        // Update progress immediately
        updateProgress(0, ids.length);

        // Worker function for concurrent fetching
        async function worker(workerId) {
          while (true) {
            const index = processed++;
            if (index >= ids.length) break;

            const id = ids[index];
            
            try {
              const response = await fetch(`${BACKEND_BASE}/ticket?id=${encodeURIComponent(id)}`);
              
              if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
              }
              
              const data = await response.json();
              
              if (data && data.success && data.ticket) {
                results[index] = {
                  id,
                  status: 'success',
                  ticket: data.ticket,
                  fetchedAt: new Date().toISOString()
                };
                successCount++;
              } else {
                results[index] = {
                  id,
                  status: 'error',
                  error: data?.message || 'Ticket not found',
                  fetchedAt: new Date().toISOString()
                };
                errorCount++;
              }
            } catch (error) {
              console.error(`Error fetching ticket ${id}:`, error);
              results[index] = {
                id,
                status: 'error',
                error: 'Network error or server unreachable',
                fetchedAt: new Date().toISOString()
              };
              errorCount++;
            }

            // Update progress
            updateProgress(index + 1, ids.length);
            updateStats(index + 1, successCount, errorCount);
          }
        }

        // Start workers
        const workers = [];
        for (let i = 0; i < Math.min(maxConcurrent, ids.length); i++) {
          workers.push(worker(i));
        }

        // Wait for all workers to complete
        await Promise.all(workers);
        
        // Filter out empty slots (just in case)
        return results.filter(r => r !== undefined);
      }

      function updateProgress(processed, total) {
        const percentage = total === 0 ? 0 : Math.round((processed / total) * 100);
        elements.progressBar.style.width = `${percentage}%`;
        
        // Update button text during processing
        if (processed < total) {
          elements.btnLookup.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Processing... (${processed}/${total})`;
        } else {
          elements.btnLookup.innerHTML = `<i class="fas fa-search"></i> Lookup Tickets`;
        }
      }

      function updateStats(processed, success, error) {
        elements.totalTickets.innerHTML = `<i class="fas fa-ticket-alt"></i> Total: ${processed}`;
        elements.processedTickets.innerHTML = `<i class="fas fa-check-circle"></i> Processed: ${processed}`;
        elements.successTickets.innerHTML = `<i class="fas fa-thumbs-up"></i> Success: ${success}`;
        elements.errorTickets.innerHTML = `<i class="fas fa-exclamation-circle"></i> Errors: ${error}`;
      }

      function renderResults() {
        if (!results || results.length === 0) {
          elements.resultsContainer.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-search"></i>
              </div>
              <h3>No Tickets Looked Up</h3>
              <p>Enter ticket IDs above and click "Lookup Tickets" to start. Results will appear here with detailed information and export options.</p>
            </div>
          `;
          elements.resultsCount.textContent = '(0 tickets)';
          return;
        }

        const successCount = results.filter(r => r.status === 'success').length;
        const errorCount = results.filter(r => r.status === 'error').length;
        elements.resultsCount.textContent = `(${results.length} tickets: ${successCount} success, ${errorCount} errors)`;

        let html = '<div class="ticket-list">';
        
        results.forEach((result, index) => {
          if (result.status === 'error') {
            html += `
              <div class="ticket-card" style="border-top-color: var(--danger);">
                <div class="ticket-header">
                  <div class="ticket-id">${escapeHtml(result.id)}</div>
                  <div class="ticket-status status-open">Error</div>
                </div>
                <div class="ticket-meta">
                  <div class="meta-item">
                    <div class="meta-label">Status</div>
                    <div class="meta-value" style="color: var(--danger);">Failed to fetch</div>
                  </div>
                  <div class="meta-item">
                    <div class="meta-label">Time</div>
                    <div class="meta-value">${new Date(result.fetchedAt).toLocaleTimeString()}</div>
                  </div>
                </div>
                <div class="ticket-description">
                  <strong>Error:</strong> ${escapeHtml(result.error || 'Unknown error')}
                </div>
                <div class="ticket-actions">
                  <button class="action-btn copy" onclick="copyToClipboard('${escapeHtml(result.id)}')">
                    <i class="fas fa-copy"></i> Copy ID
                  </button>
                  <button class="action-btn history" onclick="retryLookup('${escapeHtml(result.id)}', ${index})">
                    <i class="fas fa-redo"></i> Retry
                  </button>
                </div>
              </div>
            `;
          } else {
            const ticket = result.ticket;
            const createdDate = ticket.createdAt || ticket.created_at || ticket.date;
            const formattedDate = createdDate ? new Date(createdDate).toLocaleDateString() : 'Unknown';
            const formattedTime = createdDate ? new Date(createdDate).toLocaleTimeString() : '';
            
            // Status badge class
            const statusClass = {
              'open': 'status-open',
              'in_progress': 'status-in_progress',
              'resolved': 'status-resolved',
              'closed': 'status-resolved'
            }[ticket.status?.toLowerCase()] || 'status-open';
            
            // Status text
            const statusText = ticket.status ? ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1) : 'Open';
            
            html += `
              <div class="ticket-card">
                <div class="ticket-header">
                  <div class="ticket-id">${escapeHtml(ticket.ticketId || ticket.id || result.id)}</div>
                  <div class="ticket-status ${statusClass}">${statusText}</div>
                </div>
                <div class="ticket-meta">
                  <div class="meta-item">
                    <div class="meta-label">Priority</div>
                    <div class="meta-value">${escapeHtml(ticket.urgency || ticket.priority || 'Medium')}</div>
                  </div>
                  <div class="meta-item">
                    <div class="meta-label">Department</div>
                    <div class="meta-value">${escapeHtml(ticket.department || 'Not specified')}</div>
                  </div>
                  <div class="meta-item">
                    <div class="meta-label">Created</div>
                    <div class="meta-value">${escapeHtml(formattedDate)}</div>
                  </div>
                  <div class="meta-item">
                    <div class="meta-label">Submitted By</div>
                    <div class="meta-value">${escapeHtml(ticket.name || ticket.submitter || 'Unknown')}</div>
                  </div>
                </div>
                <div class="ticket-description" id="desc-${index}">
                  ${escapeHtml(ticket.issue || ticket.description || ticket.message || 'No description provided')}
                </div>
                <div class="ticket-actions">
                  <button class="action-btn view" onclick="viewTicketDetails(${index})">
                    <i class="fas fa-eye"></i> View Details
                  </button>
                  <button class="action-btn history" onclick="showTicketHistory(${index})">
                    <i class="fas fa-history"></i> History
                  </button>
                  <button class="action-btn copy" onclick="copyTicketInfo(${index})">
                    <i class="fas fa-copy"></i> Copy Info
                  </button>
                </div>
              </div>
            `;
          }
        });
        
        html += '</div>';
        elements.resultsContainer.innerHTML = html;
      }

      function exportToExcel() {
        if (results.length === 0) {
          alert('No results to export');
          return;
        }

        // Filter successful results only
        const successfulTickets = results.filter(r => r.status === 'success').map(r => r.ticket);
        
        if (successfulTickets.length === 0) {
          alert('No successful ticket lookups to export');
          return;
        }

        // Create Excel-compatible CSV with the template format
        const csvData = convertToExcelTemplate(successfulTickets);
        
        // Create and download file
        const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `Tomoca_Tickets_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        alert(`Exported ${successfulTickets.length} tickets to Excel CSV format`);
      }

      function exportToCSV() {
        if (results.length === 0) {
          alert('No results to export');
          return;
        }

        // Filter successful results only
        const successfulTickets = results.filter(r => r.status === 'success').map(r => r.ticket);
        
        if (successfulTickets.length === 0) {
          alert('No successful ticket lookups to export');
          return;
        }

        // Get staff member for assignment
        let staffName = currentStaff ? currentStaff.name : 'IT Department';
        
        // Create CSV in the exact template format
        const csvData = convertToTaskLogTemplate(successfulTickets, staffName);
        
        // Create and download file
        const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `Tomoca_IT_Task_Log_${staffName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        alert(`Exported ${successfulTickets.length} tickets to Task Log CSV format for ${staffName}`);
      }

      function convertToExcelTemplate(tickets) {
        // Excel template columns:
        // Date, Priority, Ticket ID, Task Description, Start Time, End Time, Duration, Status, Notes/Comments
        
        const headers = ['Date', 'Priority', 'Ticket ID', 'Task Description', 'Start Time', 'End Time', 'Duration', 'Status', 'Notes/Comments'];
        const rows = tickets.map(ticket => {
          const createdDate = ticket.createdAt || ticket.created_at || new Date().toISOString();
          const date = new Date(createdDate);
          const formattedDate = date.toISOString().split('T')[0];
          
          return [
            formattedDate,
            ticket.urgency || ticket.priority || 'Medium',
            ticket.ticketId || ticket.id || '',
            ticket.issue || ticket.description || ticket.message || '',
            '09:00', // Default start time
            '17:00', // Default end time
            '8 hours', // Default duration
            ticket.status ? ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1) : 'Open',
            `Submitted by: ${ticket.name || 'Unknown'}, Department: ${ticket.department || 'Not specified'}`
          ].map(cell => `"${(cell || '').toString().replace(/"/g, '""')}"`).join(',');
        });

        return [headers.join(','), ...rows].join('\n');
      }

      function convertToTaskLogTemplate(tickets, staffName) {
        // Full Excel template format with all columns
        const headers = [
          'Date',
          'Priority',
          'Ticket ID',
          'Task Description',
          'Start Time',
          'End Time',
          'Duration',
          'Status',
          'Notes/Comments',
          '', // Empty column
          'Staff Member',
          'Department',
          'Resolution Time',
          'Follow-up Required',
          'Category'
        ];

        const rows = tickets.map(ticket => {
          const createdDate = ticket.createdAt || ticket.created_at || new Date().toISOString();
          const date = new Date(createdDate);
          const formattedDate = date.toISOString().split('T')[0];
          const today = new Date().toISOString().split('T')[0];
          
          // Calculate random times for the log
          const startHour = 8 + Math.floor(Math.random() * 3); // 8-10 AM
          const durationHours = 1 + Math.floor(Math.random() * 4); // 1-4 hours
          const endHour = startHour + durationHours;
          
          const startTime = `${startHour.toString().padStart(2, '0')}:00`;
          const endTime = `${endHour.toString().padStart(2, '0')}:00`;
          
          // Determine status for task log
          let taskStatus = 'In Progress';
          if (ticket.status === 'resolved') taskStatus = 'Resolved';
          if (ticket.status === 'closed') taskStatus = 'Completed';
          
          // Calculate resolution time (for demo)
          const resolutionHours = Math.floor(Math.random() * 48) + 1;
          
          return [
            today, // Use today's date for task log
            ticket.urgency || ticket.priority || 'Medium',
            ticket.ticketId || ticket.id || '',
            ticket.issue || ticket.description || ticket.message || '',
            startTime,
            endTime,
            `${durationHours} hours`,
            taskStatus,
            `Initial issue: ${ticket.issue || 'No description'}. Submitted by ${ticket.name || 'Unknown'} from ${ticket.department || 'Unknown'} department.`,
            '', // Empty column
            staffName,
            ticket.department || 'IT',
            `${resolutionHours} hours`,
            ticket.status === 'resolved' ? 'No' : 'Yes',
            ticket.department || 'General'
          ].map(cell => `"${(cell || '').toString().replace(/"/g, '""')}"`).join(',');
        });

        // Add header rows to match Excel template
        const templateHeader = [
          `"TOMOCA IT Department - Daily Task Log"`,
          '',
          '',
          '',
          '',
          '',
          '',
          '',
          '',
          '',
          '',
          '',
          '',
          '',
          ''
        ];
        
        const columnHeader = [
          '"Date"',
          '"Priority"',
          '"Ticket ID"',
          '"Task Description"',
          '"Start Time"',
          '"End Time"',
          '"Duration"',
          '"Status"',
          '"Notes/Comments"',
          '""',
          '"Staff"',
          '"Department"',
          '"Resolution Time"',
          '"Follow-up Required"',
          '"Category"'
        ];

        return [templateHeader.join(','), columnHeader.join(','), ...rows].join('\n');
      }

      function copyAllToClipboard() {
        if (results.length === 0) {
          alert('No results to copy');
          return;
        }

        const dataToCopy = results.map(result => {
          if (result.status === 'error') {
            return {
              id: result.id,
              status: 'error',
              error: result.error
            };
          } else {
            return {
              id: result.id,
              status: 'success',
              ticket: result.ticket
            };
          }
        });

        const jsonString = JSON.stringify(dataToCopy, null, 2);
        navigator.clipboard.writeText(jsonString).then(() => {
          alert('All ticket data copied to clipboard!');
        }).catch(err => {
          console.error('Copy failed:', err);
          prompt('Copy the following text:', jsonString);
        });
      }

      function toggleAllDescriptions(expand) {
        results.forEach((_, index) => {
          const descElement = document.getElementById(`desc-${index}`);
          if (descElement) {
            if (expand) {
              descElement.style.maxHeight = 'none';
              descElement.style.overflow = 'visible';
              descElement.classList.remove('collapsed');
            } else {
              descElement.style.maxHeight = '100px';
              descElement.style.overflow = 'hidden';
              descElement.classList.add('collapsed');
            }
          }
        });
      }

      function setButtonsDisabled(disabled) {
        const buttons = [
          elements.btnLookup,
          elements.btnExportExcel,
          elements.btnExportCSV,
          elements.btnCopyAll,
          elements.btnClear
        ];
        
        buttons.forEach(btn => {
          btn.disabled = disabled;
          btn.style.opacity = disabled ? '0.6' : '1';
          btn.style.cursor = disabled ? 'not-allowed' : 'pointer';
        });
      }

      // Global functions for inline event handlers
      window.viewTicketDetails = function(index) {
        const result = results[index];
        if (!result || result.status !== 'success') return;
        
        const ticket = result.ticket;
        const createdDate = ticket.createdAt || ticket.created_at;
        const formattedDate = createdDate ? new Date(createdDate).toLocaleString() : 'Unknown';
        
        let html = `
          <div class="ticket-detail-grid">
            <div class="ticket-detail">
              <label>Ticket ID</label>
              <div class="value">${escapeHtml(ticket.ticketId || ticket.id || result.id)}</div>
            </div>
            <div class="ticket-detail">
              <label>Status</label>
              <div class="value">${escapeHtml(ticket.status || 'Open')}</div>
            </div>
            <div class="ticket-detail">
              <label>Priority</label>
              <div class="value">${escapeHtml(ticket.urgency || ticket.priority || 'Medium')}</div>
            </div>
            <div class="ticket-detail">
              <label>Department</label>
              <div class="value">${escapeHtml(ticket.department || 'Not specified')}</div>
            </div>
            <div class="ticket-detail">
              <label>Submitted By</label>
              <div class="value">${escapeHtml(ticket.name || 'Unknown')}</div>
            </div>
            <div class="ticket-detail">
              <label>Email</label>
              <div class="value">${escapeHtml(ticket.email || 'Not provided')}</div>
            </div>
            <div class="ticket-detail">
              <label>Created Date</label>
              <div class="value">${escapeHtml(formattedDate)}</div>
            </div>
            <div class="ticket-detail">
              <label>Last Updated</label>
              <div class="value">${escapeHtml(ticket.updated_at ? new Date(ticket.updated_at).toLocaleString() : 'Never')}</div>
            </div>
          </div>
          
          <div class="ticket-detail">
            <label>Issue Description</label>
            <div class="value" style="white-space: pre-wrap;">${escapeHtml(ticket.issue || ticket.description || ticket.message || 'No description')}</div>
          </div>
        `;
        
        if (ticket.response) {
          html += `
            <div class="ticket-detail">
              <label>IT Response</label>
              <div class="value" style="white-space: pre-wrap; background: #e8f4ff;">${escapeHtml(ticket.response)}</div>
            </div>
          `;
        }
        
        elements.modalContent.innerHTML = html;
        elements.modalOverlay.style.display = 'flex';
      };

      window.showTicketHistory = function(index) {
        const result = results[index];
        if (!result || result.status !== 'success') return;
        
        const ticket = result.ticket;
        let html = `
          <div class="ticket-detail">
            <label>Ticket History</label>
            <div class="value">${escapeHtml(ticket.ticketId || ticket.id || result.id)}</div>
          </div>
          
          <div class="history-list">
            <div class="history-item">
              <div class="history-header">
                <span class="history-actor">${escapeHtml(ticket.name || 'User')}</span>
                <span class="history-time">${ticket.createdAt ? new Date(ticket.createdAt).toLocaleString() : 'Unknown'}</span>
              </div>
              <div class="history-action">Ticket Created</div>
              <div class="history-note">${escapeHtml(ticket.issue || 'No description')}</div>
            </div>
        `;
        
        if (ticket.response) {
          html += `
            <div class="history-item">
              <div class="history-header">
                <span class="history-actor">IT Support</span>
                <span class="history-time">${ticket.updated_at ? new Date(ticket.updated_at).toLocaleString() : 'Recently'}</span>
              </div>
              <div class="history-action">Response Added</div>
              <div class="history-note">${escapeHtml(ticket.response)}</div>
            </div>
          `;
        }
        
        html += `
            <div class="history-item">
              <div class="history-header">
                <span class="history-actor">System</span>
                <span class="history-time">${new Date().toLocaleString()}</span>
              </div>
              <div class="history-action">Viewed in History Dashboard</div>
              <div class="history-note">Ticket details accessed by ${currentStaff ? currentStaff.name : 'IT Staff'}</div>
            </div>
          </div>
        `;
        
        elements.modalContent.innerHTML = html;
        elements.modalOverlay.style.display = 'flex';
      };

      window.copyTicketInfo = function(index) {
        const result = results[index];
        if (!result || result.status !== 'success') return;
        
        const ticket = result.ticket;
        const info = {
          ticketId: ticket.ticketId || ticket.id,
          status: ticket.status,
          priority: ticket.urgency || ticket.priority,
          department: ticket.department,
          submittedBy: ticket.name,
          issue: ticket.issue || ticket.description,
          response: ticket.response
        };
        
        const text = Object.entries(info)
          .filter(([_, value]) => value)
          .map(([key, value]) => `${key}: ${value}`)
          .join('\n');
        
        navigator.clipboard.writeText(text).then(() => {
          alert('Ticket information copied to clipboard!');
        }).catch(err => {
          console.error('Copy failed:', err);
        });
      };

      window.copyToClipboard = function(text) {
        navigator.clipboard.writeText(text).then(() => {
          alert('Copied to clipboard!');
        }).catch(err => {
          console.error('Copy failed:', err);
          prompt('Copy the following text:', text);
        });
      };

      window.retryLookup = async function(id, index) {
        try {
          const response = await fetch(`${BACKEND_BASE}/ticket?id=${encodeURIComponent(id)}`);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          
          const data = await response.json();
          
          if (data && data.success && data.ticket) {
            results[index] = {
              id,
              status: 'success',
              ticket: data.ticket,
              fetchedAt: new Date().toISOString()
            };
            renderResults();
            alert(`Successfully fetched ticket ${id}`);
          } else {
            alert(`Failed to fetch ticket ${id}: ${data?.message || 'Ticket not found'}`);
          }
        } catch (error) {
          console.error(`Retry error for ${id}:`, error);
          alert(`Failed to fetch ticket ${id}: Network error`);
        }
      };

      // Utility function
      function escapeHtml(str) {
        if (str === null || str === undefined) return '';
        return String(str).replace(/[&<>"']/g, s => ({
          '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
        })[s]);
      }

    })();
  </script>
</body>
</html>
[file content end]