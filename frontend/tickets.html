<!-- frontend/tickets.html -->
<!doctype html>
<html>
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>All Tickets â€” Tomoca Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#4e2b18,#d4a373);min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:28px}
  .card{background:#fff;padding:18px;border-radius:12px;max-width:1000px;width:100%;box-shadow:0 12px 30px rgba(0,0,0,0.18)}
  #list{margin-top:10px;border-radius:8px;overflow:hidden;border:1px solid #f0f0f0}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>
  <div class="card">
    <h3>Tickets</h3>
    <div class="controls">
      <input id="q" placeholder="Search by ID, name, keyword" style="flex:1;padding:10px;border-radius:8px;border:1px solid #eee">
      <select id="statusFilter" style="padding:10px;border-radius:8px;border:1px solid #eee">
        <option value="">All status</option>
        <option value="open">Open</option>
        <option value="in_progress">In Progress</option>
        <option value="resolved">Resolved</option>
      </select>
      <button id="searchBtn" style="padding:10px;border-radius:8px;background:#8B4513;color:#fff;border:none">Search</button>
    </div>

    <div id="list"></div>
  </div>

<script src="js/utils.js"></script>
<script src="js/admin.js"></script>
<script>
  (function(){
    const list = document.getElementById('list');
    const q = document.getElementById('q');
    const statusFilter = document.getElementById('statusFilter');
    const searchBtn = document.getElementById('searchBtn');

    async function load() {
      list.innerHTML = '<div style="padding:12px">Loading...</div>';
      const r = await window._admin.fetchTickets({ q: q.value.trim(), status: statusFilter.value, limit: 50 });
      if (r && r.success) {
        list.innerHTML = r.tickets.length ? r.tickets.map(t => window._admin.ticketRowHtml(t)).join('') : '<div style="padding:12px">No tickets found.</div>';
        // make copy buttons work
        document.querySelectorAll('.copy-id-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const id = btn.dataset.id;
            await window._utils.copyToClipboard(id);
            btn.textContent = 'Copied';
            setTimeout(()=> btn.textContent = 'Copy',1200);
          });
        });
      } else {
        list.innerHTML = '<div style="padding:12px">No tickets or error.</div>';
      }
    }

    searchBtn.addEventListener('click', ()=> load());
    q.addEventListener('keydown', (e)=> { if (e.key === 'Enter') load(); });

    // initial load
    load();
  })();
</script>
</body>
</html>
