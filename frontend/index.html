<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tomoca IT Support Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #4e2b18;
      --secondary: #d4a373;
      --light: #f8f5f2;
      --dark: #2c1810;
      --card: #ffffff;
      --muted: #6b7280;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
      --border: #e5e7eb;
      --radius: 12px;
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #f8f5f2 0%, #f0ebe6 100%);
      color: var(--dark);
      line-height: 1.6;
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: var(--card);
      padding: 16px 24px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      overflow: hidden;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: 700;
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .brand h1 {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 4px;
    }

    .brand p {
      font-size: 13px;
      color: var(--muted);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    /* Auth Button Styles */
    .auth-btn {
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .auth-btn-primary {
      background: linear-gradient(135deg, var(--primary), #6b3920);
      color: white;
    }

    .auth-btn-primary:hover {
      background: linear-gradient(135deg, #6b3920, var(--primary));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(78, 43, 24, 0.25);
    }

    .auth-btn-secondary {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .auth-btn-secondary:hover {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }

    /* Main Content - Centered for auth */
    .main-content {
      flex: 1;
      padding: 32px;
      overflow-y: auto;
      background: var(--light);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Auth Container */
    .auth-container {
      max-width: 440px;
      width: 100%;
      margin: 0 auto;
      padding: 40px 0;
    }

    .auth-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 40px;
      box-shadow: var(--shadow);
      border-top: 6px solid var(--primary);
    }

    .auth-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .auth-header h2 {
      font-size: 28px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .auth-header p {
      color: var(--muted);
      font-size: 15px;
    }

    .auth-tabs {
      display: flex;
      background: var(--light);
      border-radius: 10px;
      padding: 6px;
      margin-bottom: 32px;
    }

    .auth-tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      background: transparent;
      border: none;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 14px;
      color: var(--muted);
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .auth-tab.active {
      background: var(--card);
      color: var(--primary);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-size: 14px;
      font-weight: 600;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group label i {
      color: var(--muted);
      font-size: 13px;
    }

    .form-control {
      padding: 14px 16px;
      border-radius: 10px;
      border: 2px solid var(--border);
      font-family: 'Poppins', sans-serif;
      font-size: 15px;
      background: white;
      color: var(--dark);
      transition: all 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(212, 163, 115, 0.2);
    }

    .password-container {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--muted);
      cursor: pointer;
    }

    .auth-actions {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 8px;
    }

    .auth-submit-btn {
      padding: 16px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, var(--primary), #6b3920);
      color: white;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .auth-submit-btn:hover {
      background: linear-gradient(135deg, #6b3920, var(--primary));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(78, 43, 24, 0.25);
    }

    .auth-submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .auth-footer {
      text-align: center;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .auth-footer p {
      color: var(--muted);
      font-size: 14px;
    }

    .auth-footer a {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
    }

    .auth-footer a:hover {
      text-decoration: underline;
    }

    .auth-message {
      padding: 14px 18px;
      border-radius: 10px;
      font-size: 14px;
      display: none;
    }

    .auth-message.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
      display: block;
    }

    .auth-message.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
      display: block;
    }

    .auth-message.warning {
      background: #fef3c7;
      color: #92400e;
      border: 1px solid #fde68a;
      display: block;
    }

    /* Loading State */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Footer */
    .footer {
      background: var(--dark);
      color: white;
      padding: 24px 32px;
      margin-top: auto;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 24px;
    }

    .footer-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .footer-logo .logo {
      width: 40px;
      height: 40px;
      font-size: 18px;
    }

    .footer-logo h3 {
      font-size: 18px;
      font-weight: 600;
    }

    .footer-copyright {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
    }

    /* Utility Classes */
    .hidden {
      display: none !important;
    }

    .visible {
      display: block !important;
    }

    .flex {
      display: flex !important;
    }

    .text-center {
      text-align: center;
    }

    .text-muted {
      color: var(--muted);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }
      
      .auth-card {
        padding: 24px;
      }
      
      .footer-content {
        flex-direction: column;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="globalLoading">
    <div class="loading-spinner"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="logo-container">
      <div class="logo">
        <img src="./assets/logo.jpg" alt="Tomoca Coffee Logo" onerror="this.style.display='none'; this.parentElement.innerHTML='☕'; this.parentElement.style.fontSize='24px';">
      </div>
      <div class="brand">
        <h1>Tomoca IT Support Portal</h1>
        <p id="headerStatus">Please sign in</p>
      </div>
    </div>
    <div class="header-actions" id="authControls">
      <!-- Will be populated by JavaScript -->
    </div>
  </header>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Main Content -->
    <main class="main-content" id="mainContent">
      <!-- Authentication Page (Always visible initially) -->
      <div id="authPage" class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <h2><i class="fas fa-shield-alt"></i> Welcome</h2>
            <p>Sign in to access the IT Support Portal</p>
          </div>
          
          <div class="auth-tabs">
            <button class="auth-tab active" data-tab="signin">Sign In</button>
            <button class="auth-tab" data-tab="signup">Sign Up</button>
          </div>
          
          <!-- Sign In Form -->
          <form id="signinForm" class="auth-form">
            <div class="auth-message" id="signinMessage"></div>
            <div class="form-group">
              <label for="signinEmail"><i class="fas fa-envelope"></i> Email Address</label>
              <input type="email" id="signinEmail" class="form-control" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
              <label for="signinPassword"><i class="fas fa-lock"></i> Password</label>
              <div class="password-container">
                <input type="password" id="signinPassword" class="form-control" placeholder="Enter your password" required>
                <button type="button" class="password-toggle" data-target="signinPassword">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <div class="auth-actions">
              <button type="submit" class="auth-submit-btn" id="signinBtn">
                <i class="fas fa-sign-in-alt"></i> Sign In
              </button>
            </div>
            <div class="auth-footer">
              <p><strong>Admin Login:</strong> btesfaye236@gmail.com / admin</p>
            </div>
          </form>
          
          <!-- Sign Up Form -->
          <form id="signupForm" class="auth-form hidden">
            <div class="auth-message" id="signupMessage"></div>
            <div class="form-group">
              <label for="signupName"><i class="fas fa-user"></i> Full Name</label>
              <input type="text" id="signupName" class="form-control" placeholder="Enter your full name" required>
            </div>
            <div class="form-group">
              <label for="signupEmail"><i class="fas fa-envelope"></i> Email Address</label>
              <input type="email" id="signupEmail" class="form-control" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
              <label for="signupPassword"><i class="fas fa-lock"></i> Password</label>
              <div class="password-container">
                <input type="password" id="signupPassword" class="form-control" placeholder="Create a password (min. 8 chars)" required>
                <button type="button" class="password-toggle" data-target="signupPassword">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
            <div class="auth-actions">
              <button type="submit" class="auth-submit-btn" id="signupBtn">
                <i class="fas fa-user-plus"></i> Create Account
              </button>
            </div>
          </form>
          
          <div class="auth-footer">
            <p>By signing in, you agree to our <a href="#">Terms of Service</a></p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">
        <div class="logo">
          <i class="fas fa-coffee"></i>
        </div>
        <h3>Tomoca IT Support</h3>
      </div>
      <div class="footer-copyright">
        © 2024 Tomoca Coffee. Enterprise Support System
      </div>
    </div>
  </footer>

<!-- Include Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  (function() {
    // IMPORTANT: Replace these with your actual Supabase credentials
    const SUPABASE_URL = 'https://zdxjvqmwblcpewogcxmd.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkeGp2cW13YmxjcGV3b2djeG1kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5NjU0MjIsImV4cCI6MjA4MTU0MTQyMn0.JKvDcX9MTUESD1e3fAWN_SeUzojUaaez5ZXOwPU8psM';

    // Admin email list (you can add more emails here)
    const ADMIN_EMAILS = ['btesfaye236@gmail.com', 'bereket@gmail.com'];

    // Initialize Supabase
    let supabase;
    try {
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      console.log('Supabase initialized successfully');
    } catch (error) {
      console.error('Failed to initialize Supabase:', error);
      alert('Failed to initialize database connection. Please check console.');
    }

    // State
    let currentUser = null;
    
    // DOM Elements
    const elements = {
      globalLoading: document.getElementById('globalLoading'),
      authControls: document.getElementById('authControls'),
      headerStatus: document.getElementById('headerStatus')
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', init);

    async function init() {
      console.log('Initializing Tomoca IT Support Portal...');
      
      // Setup event listeners
      setupEventListeners();
      
      // Check if user is already logged in
      await checkCurrentSession();
    }

    function setupEventListeners() {
      // Auth tab switching
      document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
          const tabId = e.target.dataset.tab;
          switchAuthTab(tabId);
        });
      });

      // Password toggle buttons
      document.querySelectorAll('.password-toggle').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const targetId = e.target.closest('.password-toggle').dataset.target;
          togglePasswordVisibility(targetId);
        });
      });

      // Sign in form
      document.getElementById('signinForm').addEventListener('submit', handleSignIn);
      
      // Sign up form
      document.getElementById('signupForm').addEventListener('submit', handleSignUp);
    }

    // Authentication Functions - REAL SUPABASE AUTHENTICATION
    async function checkCurrentSession() {
      if (!supabase) {
        console.error('Supabase not initialized');
        return;
      }

      showLoading(true);
      try {
        // Get current session from Supabase
        const { data: { session }, error } = await supabase.auth.getSession();
        
        if (error) {
          console.error('Error checking session:', error);
          showLoading(false);
          return;
        }

        if (session?.user) {
          // User is logged in
          console.log('Found existing session:', session.user);
          
          // Get user profile from profiles table
          const { data: profile, error: profileError } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', session.user.id)
            .single();
            
          if (profileError && profileError.code !== 'PGRST116') {
            console.error('Error fetching profile:', profileError);
          }
          
          // Determine if user is admin
          const isAdmin = ADMIN_EMAILS.includes(session.user.email) || (profile?.role === 'admin');
          
          // Set current user
          currentUser = {
            id: session.user.id,
            email: session.user.email,
            name: profile?.name || session.user.user_metadata?.name || session.user.email.split('@')[0],
            role: profile?.role || 'user',
            isAdmin: isAdmin
          };
          
          console.log('Current user set:', currentUser);
          
          // Update UI and redirect based on role
          updateUI();
          redirectBasedOnRole();
        }
      } catch (error) {
        console.error('Session check error:', error);
      } finally {
        showLoading(false);
      }
    }

    async function handleSignIn(e) {
      e.preventDefault();
      if (!supabase) {
        showAuthMessage('Database connection not available', 'error');
        return;
      }

      showLoading(true);

      const email = document.getElementById('signinEmail').value.trim();
      const password = document.getElementById('signinPassword').value;

      try {
        // Clear previous messages
        clearAuthMessages();
        
        // Sign in with Supabase
        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password
        });
        
        if (error) {
          showAuthMessage(error.message, 'error');
          showLoading(false);
          return;
        }

        if (data.user) {
          // Get user profile
          const { data: profile, error: profileError } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', data.user.id)
            .single();
            
          if (profileError && profileError.code !== 'PGRST116') {
            console.error('Error fetching profile:', profileError);
          }
          
          // Determine if user is admin
          const isAdmin = ADMIN_EMAILS.includes(data.user.email) || (profile?.role === 'admin');
          
          // Set current user
          currentUser = {
            id: data.user.id,
            email: data.user.email,
            name: profile?.name || data.user.user_metadata?.name || data.user.email.split('@')[0],
            role: profile?.role || 'user',
            isAdmin: isAdmin
          };
          
          // Show success message
          showAuthMessage('Successfully signed in! Redirecting...', 'success');
          
          // Redirect based on role after delay
          setTimeout(() => {
            redirectBasedOnRole();
          }, 1500);
        }
      } catch (error) {
        console.error('Sign in error:', error);
        showAuthMessage('An error occurred during sign in.', 'error');
      } finally {
        showLoading(false);
      }
    }

    async function handleSignUp(e) {
      e.preventDefault();
      if (!supabase) {
        showAuthMessage('Database connection not available', 'error');
        return;
      }

      showLoading(true);

      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;

      try {
        // Clear previous messages
        clearAuthMessages();
        
        // Validation
        if (password.length < 8) {
          showAuthMessage('Password must be at least 8 characters', 'error');
          showLoading(false);
          return;
        }

        // Sign up with Supabase
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: {
              name: name
            }
          }
        });
        
        if (error) {
          showAuthMessage(error.message, 'error');
          showLoading(false);
          return;
        }

        if (data.user) {
          // Create profile in profiles table
          const { error: profileError } = await supabase
            .from('profiles')
            .insert([
              {
                id: data.user.id,
                name: name,
                email: email,
                role: 'user', // Default role is user
                created_at: new Date().toISOString()
              }
            ]);
            
          if (profileError) {
            console.error('Profile creation error:', profileError);
            // Continue anyway - profile might be created by trigger
          }
          
          showAuthMessage('Account created successfully! Please check your email for verification.', 'success');
          
          // Clear form
          document.getElementById('signupForm').reset();
          
          // Switch to sign in tab after delay
          setTimeout(() => {
            switchAuthTab('signin');
          }, 3000);
        }
      } catch (error) {
        console.error('Sign up error:', error);
        showAuthMessage('An error occurred during sign up.', 'error');
      } finally {
        showLoading(false);
      }
    }

    async function handleSignOut() {
      if (!supabase) return;
      
      showLoading(true);
      try {
        const { error } = await supabase.auth.signOut();
        
        if (error) {
          console.error('Sign out error:', error);
          return;
        }
        
        currentUser = null;
        updateUI();
        window.location.href = 'index.html';
      } catch (error) {
        console.error('Sign out error:', error);
      } finally {
        showLoading(false);
      }
    }

    // Redirect user based on their role
    function redirectBasedOnRole() {
      if (!currentUser) return;
      
      if (currentUser.isAdmin) {
        // Redirect admin to admin dashboard
        window.location.href = 'dashboard.html';
      } else {
        // Redirect regular user to submit ticket page
        window.location.href = 'submit-ticket.html';
      }
    }

    // UI Functions
    function updateUI() {
      // Update header
      if (currentUser) {
        elements.headerStatus.textContent = `Welcome, ${currentUser.name}`;
        
        elements.authControls.innerHTML = `
          <div class="user-info">
            <div class="user-avatar">${currentUser.name.charAt(0).toUpperCase()}</div>
            <div class="user-details">
              <h4>${currentUser.name}</h4>
              <p>${currentUser.email}</p>
              ${currentUser.isAdmin ? '<small style="color: var(--warning); font-weight: 600;">ADMIN</small>' : ''}
            </div>
          </div>
          <button class="auth-btn auth-btn-secondary" id="signoutBtn">
            <i class="fas fa-sign-out-alt"></i> Sign Out
          </button>
        `;
        
        document.getElementById('signoutBtn').addEventListener('click', handleSignOut);
        
      } else {
        elements.headerStatus.textContent = 'Please sign in';
        
        elements.authControls.innerHTML = `
          <button class="auth-btn auth-btn-primary" id="signinNavBtn">
            <i class="fas fa-sign-in-alt"></i> Sign In
          </button>
        `;
        
        document.getElementById('signinNavBtn').addEventListener('click', () => {
          window.location.href = 'index.html';
        });
      }
    }

    function switchAuthTab(tabId) {
      // Update tabs
      document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === tabId);
      });
      
      // Show selected form
      const forms = ['signinForm', 'signupForm'];
      forms.forEach(formId => {
        const form = document.getElementById(formId);
        if (formId === `${tabId}Form`) {
          form.classList.remove('hidden');
        } else {
          form.classList.add('hidden');
        }
      });
      
      // Clear messages
      clearAuthMessages();
    }

    function clearAuthMessages() {
      document.getElementById('signinMessage').className = 'auth-message';
      document.getElementById('signinMessage').innerHTML = '';
      document.getElementById('signupMessage').className = 'auth-message';
      document.getElementById('signupMessage').innerHTML = '';
    }

    function togglePasswordVisibility(targetId) {
      const input = document.getElementById(targetId);
      const button = document.querySelector(`[data-target="${targetId}"] i`);
      
      if (input.type === 'password') {
        input.type = 'text';
        button.className = 'fas fa-eye-slash';
      } else {
        input.type = 'password';
        button.className = 'fas fa-eye';
      }
    }

    function showLoading(show) {
      elements.globalLoading.style.display = show ? 'flex' : 'none';
    }

    function showAuthMessage(message, type = 'error') {
      const activeTab = document.querySelector('.auth-tab.active').dataset.tab;
      const messageEl = document.getElementById(`${activeTab}Message`);
      messageEl.className = `auth-message ${type}`;
      messageEl.innerHTML = message;
    }

    // Utility Functions
    function escapeHtml(str) {
      return String(str || '').replace(/[&<>"']/g, s => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      })[s]);
    }

    // Listen for auth state changes
    if (supabase) {
      supabase.auth.onAuthStateChange((event, session) => {
        console.log('Auth state changed:', event);
        
        if (event === 'SIGNED_IN' && session?.user) {
          // User signed in
          console.log('User signed in:', session.user);
          
          // We'll update the user in checkCurrentSession
        } else if (event === 'SIGNED_OUT') {
          // User signed out
          currentUser = null;
          updateUI();
          window.location.href = 'index.html';
        }
      });
    }

  })();
</script>
</body>
</html>