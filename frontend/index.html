<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tomoca IT Support</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="page-wrapper">

    <!-- LEFT: Vertical Navigation (sidebar) -->
    <aside class="sidebar" role="navigation" aria-label="Main navigation">
      <nav class="nav">
        <a class="nav-btn" href="index.html">Submit Ticket</a>
        <a class="nav-btn" href="track.html">Track Ticket</a>
        <a class="nav-btn" href="history.html">History</a>
        <a class="nav-btn" href="faq.html">FAQ</a>
        <a class="nav-btn" href="contact-it.html">Contact IT</a>
        <a class="nav-btn admin" href="dashboard.html">Admin Dashboard</a>
        <a class="nav-btn admin" href="tickets.html">All Tickets</a>
      </nav>
    </aside>

    <!-- RIGHT: Main content (wider and compact) -->
    <main class="main-content" role="main">
      <div class="ticket-wrapper" aria-live="polite">

        <!-- left info panel inside the card -->
        <div class="ticket-info" aria-hidden="true">
          <div class="brand">
            <div class="brand-top">
              <div class="brand-icon">☕</div>
              <div class="brand-title">
                <div class="brand-name">Tomoca Coffee</div>
                <div class="brand-sub">IT Support Desk</div>
              </div>
            </div>

            <h2>Fast help for your work</h2>
            <p class="brand-desc">
              Submit your issue and our IT team will respond quickly. Include the ticket ID in follow-ups.
            </p>
            <small class="tip">Tip: Attach screenshots in the admin panel (coming soon).</small>
          </div>
        </div>

        <!-- right form panel inside the card -->
        <div class="ticket-form">
          <div class="form-header">
            <div>
              <h3>Submit a support ticket</h3>
              <p class="muted">Please describe your issue clearly — our team will get back to you.</p>
            </div>
            <div class="meta">Support System <strong>v1.0</strong></div>
          </div>

          <form id="supportForm" autocomplete="off">
            <div class="form-row">
              <label for="name">Your Name *</label>
              <input id="name" name="name" type="text" placeholder="Enter your full name" required />
            </div>

            <div class="form-row split">
              <div class="col">
                <label for="department">Department *</label>
                <select id="department" name="department" required>
                  <option value="">Select your department</option>
                  <option value="HR">Human Resources</option>
                  <option value="Finance">Finance</option>
                  <option value="Marketing">Marketing</option>
                  <option value="Operations">Operations</option>
                  <option value="Sales">Sales</option>
                  <option value="Coffee Production">Coffee Production</option>
                  <option value="Retail">Retail</option>
                  <option value="Other">Other</option>
                </select>
              </div>

              <div class="col small">
                <label for="urgency">Urgency *</label>
                <select id="urgency" name="urgency" required>
                  <option value="">Select</option>
                  <option value="Low">Low</option>
                  <option value="Medium">Medium</option>
                  <option value="High">High</option>
                  <option value="Critical">Critical</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <label for="issue">Issue Description *</label>
              <textarea id="issue" name="issue" placeholder="Please describe your issue in detail..." required></textarea>
            </div>

            <div class="form-row">
              <button id="submitBtn" class="submit-btn" type="submit">Submit Ticket</button>
            </div>

            <div id="loading" class="loading" aria-hidden="true">
              <div class="spinner" role="img" aria-label="Loading"></div>
              <div class="loading-text">Submitting your ticket...</div>
            </div>

            <div id="responseMessage" class="response-message" role="status"></div>

            <div class="footer-note">Tomoca Coffee IT Department | Support System v1.0</div>
          </form>
        </div>
      </div>
    </main>
  </div>

  <!-- KEEP backend URL unchanged -->
  <script>
  (function(){
    const form = document.getElementById('supportForm');
    const submitBtn = document.getElementById('submitBtn');
    const loading = document.getElementById('loading');
    const responseMessage = document.getElementById('responseMessage');

    function showLoading(on){ loading.style.display = on ? 'flex' : 'none'; }
    function showMessage(type, html){
      responseMessage.className = 'response-message ' + (type || '');
      responseMessage.innerHTML = html;
      responseMessage.style.display = 'block';
    }

    form.addEventListener('submit', async function(e){
      e.preventDefault();

      const formData = {
        name: document.getElementById('name').value.trim(),
        department: document.getElementById('department').value,
        urgency: document.getElementById('urgency').value,
        issue: document.getElementById('issue').value.trim()
      };

      if (!formData.name || !formData.department || !formData.urgency || !formData.issue) {
        showMessage('error', '❌ Please fill in all required fields.');
        return;
      }

      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Submitting...';
      showLoading(true);
      responseMessage.style.display = 'none';

      try {
        const response = await fetch('https://tomoca.onrender.com/submit-ticket', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        responseMessage.style.display = 'block';
        if (data && data.success) {
          showMessage('success', `✅ <strong>Ticket Submitted Successfully!</strong><br>Your Ticket ID: <code>${data.ticketId}</code><br><small>The IT team has been notified and will contact you shortly.</small>`);
          form.reset();
        } else {
          const msg = (data && data.message) ? data.message : 'Failed to submit ticket.';
          showMessage('error', '❌ ' + msg);
        }
      } catch (err) {
        console.error('Error submitting ticket:', err);
        showMessage('error', '❌ Network error. Please check your connection and try again.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        showLoading(false);
      }
    });
  })();
  </script>
</body>
</html>
